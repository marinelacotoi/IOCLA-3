#include <stdio.h>
#include <string.h>
#include <stdlib.h>

int term(char *s, int *i);
int expression(char *s, int *i)
{
    long result = term(s, i);

    while (s[*i] == '+' || s[*i] == '-')
    {
        char a = s[*i];
        *i = *i + 1;
        int next_value = term(s, i);
        if (a == '+')
        {
            result += next_value;
        }
        else
        {
            result -= next_value;
        }
    }
    printf("[EXP] %ld ", result);
    return result;
}

int factor(char *s, int *i)
{
    long result = 0;
    if (s[*i] == '(')
    {
        *i = *i + 1;
        result = expression(s, i);
        *i = *i + 1;
    }
    else
    {
        char *delim = "*/-+)";
        while (*i != (strlen(s)))
        {
            if (strchr(delim, s[*i]))
            {
                break;
            }
            result = result * 10 + s[*i] - '0';
            (*i)++;
        }
    }
    printf("[FACTOR]: %ld ", result);
    return result;
}

int term(char *s, int *i)
{
    long result = factor(s, i);
    while (s[*i] == '*' || s[*i] == '/')
    {
        char a = s[*i];
        *i = *i + 1;
        int next_value = factor(s, i);
        if (a == '*')
        {
            result *= next_value;
        }
        if (a == '/')
        {
            result /= next_value;
        }
    }
    printf("[TERM] %ld ", result);
    return result;
}

int main()
{
    char s[100000] = "(56*52-(98+33)+(296+(286+891+(82+179+358-(48)*(0/173))-(251)))+(1661-(690+3731-(1919+2156)))+3777-4088+(4733)+(4675/1914)+433-3786+3173+3561+(2395-(419))+(849*63+2065*42-3074+2338*78+(3369))/(3639+1115+2328*(60))*35*(17*63/(4093*(99/(4484)*(42)+466+1804)/1696+(2250+2811*(3*76)/3777*25*(65)))*(99*41)+(4086+(1062*23*45+2978+362))+394)+(3101*6+18*97+4435+968*(62*(31+3311))+3592+2668*8-58+(4396/(2336))+(3054-(1993/2160*(2+4093))+629*14*53+3732*45*0+2775*(56*92+(4416+(4829)+(2724)))))+(1364+(952+(301*66+(2531+715/(3876)))+4144)+(789/(1511+1933+2021*48/(4198)+638))+(1793*66*1+(4461+224/(1180+619-1497/3226+(3278)*41))+4672*26-(1190/(2560)))+(4878-2801))+56*52-(98+33)+(296+(286+891+(82+179+358-(48)*(0/173))-(251)))+(1661-(690+3731-(1919+2156)))+3777-4088+(4733)+(4675/1914)+433-3786+3173+3561+(2395-(419))+(849*63+2065*42-3074+2338*78+(3369))/(3639+1115+2328*(60))*35*(17*63/(4093*(99/(4484)*(42)+466+1804)/1696+(2250+2811*(3*76)/3777*25*(65)))*(99*41)+(4086+(1062*23*45+2978+362))+394)+(3101*6+18*97+4435+968*(62*(31+3311))+3592+2668*8-58+(4396/(2336))+(3054-(1993/2160*(2+4093))+629*14*53+3732*45*0+2775*(56*92+(4416+(4829)+(2724)))))+(1364+(952+(301*66+(2531+715/(3876)))+4144)+(789/(1511+1933+2021*48/(4198)+638))+(1793*66*1+(4461+224/(1180+619-1497/3226+(3278)*41))+4672*26-(1190/(2560)))+(4878-2801))+56*52-(98+33)+(296+(286+891+(82+179+358-(48)*(0/173))-(251)))+(1661-(690+3731-(1919+2156)))+3777-4088+(4733)+(4675/1914)+433-3786+3173+3561+(2395-(419))+(849*63+2065*42-3074+2338*78+(3369))/(3639+1115+2328*(60))*35*(17*63/(4093*(99/(4484)*(42)+466+1804)/1696+(2250+2811*(3*76)/3777*25*(65)))*(99*41)+(4086+(1062*23*45+2978+362))+394)+(3101*6+18*97+4435+968*(62*(31+3311))+3592+2668*8-58+(4396/(2336))+(3054-(1993/2160*(2+4093))+629*14*53+3732*45*0+2775*(56*92+(4416+(4829)+(2724)))))+(1364+(952+(301*66+(2531+715/(3876)))+4144)+(789/(1511+1933+2021*48/(4198)+638))+(1793*66*1+(4461+224/(1180+619-1497/3226+(3278)*41))+4672*26-(1190/(2560)))+(4878-2801)))/200+56*52-(98+33)+(296+(286+891+(82+179+358-(48)*(0/173))-(251)))+(1661-(690+3731-(1919+2156)))+3777-4088+(4733)+(4675/1914)+433-3786+3173+3561+(2395-(419))+(849*63+2065*42-3074+2338*78+(3369))/(3639+1115+2328*(60))*35*(17*63/(4093*(99/(4484)*(42)+466+1804)/1696+(2250+2811*(3*76)/3777*25*(65)))*(99*41)+(4086+(1062*23*45+2978+362))+394)+(3101*6+18*97+4435+968*(62*(31+3311))+3592+2668*8-58+(4396/(2336))+(3054-(1993/2160*(2+4093))+629*14*53+3732*45*0+2775*(56*92+(4416+(4829)+(2724)))))+(1364+(952+(301*66+(2531+715/(3876)))+4144)+(789/(1511+1933+2021*48/(4198)+638))+(1793*66*1+(4461+224/(1180+619-1497/3226+(3278)*41))+4672*26-(1190/(2560)))+(4878-2801))+(56*52-(98+33)+(296+(286+891+(82+179+358-(48)*(0/173))-(251)))+(1661-(690+3731-(1919+2156)))+3777-4088+(4733)+(4675/1914)+433-3786+3173+3561+(2395-(419))+(849*63+2065*42-3074+2338*78+(3369))/(3639+1115+2328*(60))*35*(17*63/(4093*(99/(4484)*(42)+466+1804)/1696+(2250+2811*(3*76)/3777*25*(65)))*(99*41)+(4086+(1062*23*45+2978+362))+394)+(3101*6+18*97+4435+968*(62*(31+3311))+3592+2668*8-58+(4396/(2336))+(3054-(1993/2160*(2+4093))+629*14*53+3732*45*0+2775*(56*92+(4416+(4829)+(2724)))))+(1364+(952+(301*66+(2531+715/(3876)))+4144)+(789/(1511+1933+2021*48/(4198)+638))+(1793*66*1+(4461+224/(1180+619-1497/3226+(3278)*41))+4672*26-(1190/(2560)))+(4878-2801))+56*52-(98+33)+(296+(286+891+(82+179+358-(48)*(0/173))-(251)))+(1661-(690+3731-(1919+2156)))+3777-4088+(4733)+(4675/1914)+433-3786+3173+3561+(2395-(419))+(849*63+2065*42-3074+2338*78+(3369))/(3639+1115+2328*(60))*35*(17*63/(4093*(99/(4484)*(42)+466+1804)/1696+(2250+2811*(3*76)/3777*25*(65)))*(99*41)+(4086+(1062*23*45+2978+362))+394)+(3101*6+18*97+4435+968*(62*(31+3311))+3592+2668*8-58+(4396/(2336))+(3054-(1993/2160*(2+4093))+629*14*53+3732*45*0+2775*(56*92+(4416+(4829)+(2724)))))+(1364+(952+(301*66+(2531+715/(3876)))+4144)+(789/(1511+1933+2021*48/(4198)+638))+(1793*66*1+(4461+224/(1180+619-1497/3226+(3278)*41))+4672*26-(1190/(2560)))+(4878-2801))+56*52-(98+33)+(296+(286+891+(82+179+358-(48)*(0/173))-(251)))+(1661-(690+3731-(1919+2156)))+3777-4088+(4733)+(4675/1914)+433-3786+3173+3561+(2395-(419))+(849*63+2065*42-3074+2338*78+(3369))/(3639+1115+2328*(60))*35*(17*63/(4093*(99/(4484)*(42)+466+1804)/1696+(2250+2811*(3*76)/3777*25*(65)))*(99*41)+(4086+(1062*23*45+2978+362))+394))/50+(3101*6+18*97+4435+968*(62*(31+3311))+3592+2668*8-58+(4396/(2336))+(3054-(1993/2160*(2+4093))+629*14*53+3732*45*0+2775*(56*92+(4416+(4829)+(2724)))))+(1364+(952+(301*66+(2531+715/(3876)))+4144)+(789/(1511+1933+2021*48/(4198)+638))+(1793*66*1+(4461+224/(1180+619-1497/3226+(3278)*41))+4672*26-(1190/(2560)))+(4878-2801))+56*52-(98+33)+(296+(286+891+(82+179+358-(48)*(0/173))-(251)))+(1661-(690+3731-(1919+2156)))+3777-4088+(4733)+(4675/1914)+433-3786+3173+3561+(2395-(419))+(849*63+2065*42-3074+2338*78+(3369))/(3639+1115+2328*(60))*35*(17*63/(4093*(99/(4484)*(42)+466+1804)/1696+(2250+2811*(3*76)/3777*25*(65)))*(99*41)+(4086+(1062*23*45+2978+362))+394)+(3101*6+18*97+4435+968*(62*(31+3311))+3592+2668*8-58+(4396/(2336))+(3054-(1993/2160*(2+4093))+629*14*53+3732*45*0+2775*(56*92+(4416+(4829)+(2724)))))+(1364+(952+(301*66+(2531+715/(3876)))+4144)+(789/(1511+1933+2021*48/(4198)+638))+(1793*66*1+(4461+224/(1180+619-1497/3226+(3278)*41))+4672*26-(1190/(2560)))+(4878-2801))";
    int i = 0;
    printf("R: %d\n", expression(s, &i));
}